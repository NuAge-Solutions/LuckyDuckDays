OJ.importJs("nw.app.Session");OJ.importJs("nw.window.WindowManager");OJ.importJs("nw.net.UrlLoader");OJ.importJs("nw.net.UrlRequest");OJ.importJs("nw.utils.CacheManager");OJ.importJs("oj.components.Component");OJ.importJs("oj.components.Overlay");OJ.importJs("oj.events.MouseEvent");OJ.importJs("oj.fx.Fade");OJ.importJs("oj.fx.Resize");OJ.importJs("oj.fx.TweenEvent");OJ.importJs("oj.fx.TweenSet");OJ.importJs("oj.net.Rpc");OJ.importCss("nw.app.App");"use strict";OJ.extendClass(OjComponent,"NwApp",{_get_props_:{maxWidth:null,maxHeight:null,minWidth:320,minHeight:320,session:null,systemBar:"appSystemBarDefault"},_api_endpoint:"/",_api_request_type:OjUrlRequest.QUERY_STRING,_api_response_type:null,_orientations:null,_loading:null,_ready:false,_scale:1,_timer:null,_acl:null,_constructor:function(){this._super("NwApp","_constructor",arguments);if(OJ.isMobile()){this.setSystemBar(NwApp.SYSTEM_BAR_DEFAULT);this._scale=OJ.getPixelRatio();OJ.meta("viewport","initial-scale=1, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no");OJ.meta("apple-mobile-web-app-capable","yes")}if(this._orientations){NW.setSupportedOrientations(this._orientations)}if(this._minWidth&&this._minHeight){NW.setMinSize(this._minWidth,this._minHeight)}if(this._maxWidth&&this._maxHeight){NW.setMaxSize(this._maxWidth,this._maxHeight)}this._acl={}},_buildApiUrl:function(a){return this._api_endpoint+a},_login:function(){this.dispatchEvent(new OjEvent(NwApp.LOGIN));AppManager.dispatchEvent(new OjEvent(NwApp.LOGIN))},_loginFail:function(){this.dispatchEvent(new OjEvent(NwApp.LOGIN_FAIL));AppManager.dispatchEvent(new OjEvent(NwApp.LOGIN_FAIL))},_logout:function(){this.dispatchEvent(new OjEvent(NwApp.LOGOUT));AppManager.dispatchEvent(new OjEvent(NwApp.LOGOUT))},_logout_fail:function(){this.dispatchEvent(new OjEvent(NwApp.LOGOUT_FAIL));AppManager.dispatchEvent(new OjEvent(NwApp.LOGOUT_FAIL))},_makeSession:function(){return new NwSession()},_onSaveSession:function(a){CacheManager.setData(this.className(),this._session)},_onSessionChange:function(a){this._timer.restart()},apiRequest:function(d,c){var b=arguments.length;var a=new NwUrlLoader(new NwUrlRequest(this._buildApiUrl(d),c,this._api_request_type,b>2?arguments[2]:OjUrlRequest.GET),b>3?arguments[3]:true);a.setContentType(this._api_response_type);return a},hideLoading:function(){if(this._loading){this._loading.hide();this._loading=null}},init:function(){if(!(this._session=CacheManager.getData(this.className()))){this._session=this._makeSession()}this._timer=new OjTimer(500,1);this._timer.addEventListener(OjTimer.COMPLETE,this,"_onSaveSession");this._session.addEventListener(OjEvent.CHANGE,this,"_onSessionChange");this.redraw();return this._session},isLoggedIn:function(){return !isNull(this._session)&&!isEmpty(this._session.getToken())},login:function(){},logout:function(){},showLoading:function(){var b=arguments.length,c=b?arguments[0]:"Loading",a=b>1?arguments[1]:null;if(this._loading){this._loading.setMessage(c);this._loading.setIcon(a)}else{this._loading=new OjOverlay(c,a);this._loading.show(OJ)}},setSystemBar:function(b){this._systemBar=b;if(NwApp.OS==NwApp.IOS){var a;switch(this._systemBar){case NwApp.SYSTEM_BAR_BLACK:a="black";break;case NwApp.SYSTEM_BAR_BLACK_NONE:case NwApp.SYSTEM_BAR_BLACK_TRANS:a="black-translucent";break;default:a="default";break}OJ.meta("apple-mobile-web-app-status-bar-style",a)}},getTitle:function(){return this.title.getText()},setTitle:function(a){this.title.setText(a)}},{LOGIN:"onLogin",LOGIN_FAIL:"onLoginFail",LOGOUT:"onLogout",LOGOUT_FAIL:"onLogoutFail",SYSTEM_BAR_BLACK:"appSystemBarBlack",SYSTEM_BAR_BLACK_TRANS:"appSystemBarBlackTranslucent",SYSTEM_BAR_DEFAULT:"appSystemBarDefault",SYSTEM_BAR_NONE:"appSystemBarNone"});