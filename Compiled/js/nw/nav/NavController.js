OJ.importJs("nw.nav.NavRoute");OJ.importJs("oj.nav.NavController");OJ.importJs("oj.utils.HistoryManager");OJ.importCss("nw.nav.NavController");"use strict";OJ.extendClass(OjComponent,"NwNavController",OJ.implementInterface(OjINavController,{_props_:{routing:null},_active:null,_active_index:-1,_active_view:null,_constructor:function(){this._super("NwNavController","_constructor",[]);this.setVertAlign(OjStyleElement.MIDDLE);this._history=[];var a=arguments.length;if(a){this.setStack(arguments[0]);if(a>1){this.setRouting(arguments[1])}}HistoryManager.addEventListener(HistoryManager.CHANGE,this,"_onHashChange")},_destructor:function(){HistoryManager.removeEventListener(HistoryManager.CHANGE,this,"_onHashChange");this._cleanupStack();if(this._routing){this._routing.removeEventListener(OjEvent.CHANGE,this,"_onRoutingChange");var a=HistoryManager.get();a.setHashParam(this.getId(),null);OJ.open(a)}return this._super("NwNavController","_destructor",arguments)},_getDefaultRoute:function(){return this._routing},_getRouteByPath:function(f,a){var e,b,d=[],g,c={};for(e=a.length;e--;){b=a[e];if(g=b.pathMatchQuality(f)){if(!c[g]){c[g]=b}if(g==1){return c}}d=b.getItems().concat(d)}if(d.length){return OJ.merge(c,this._getRouteByPath(f,d))}return c},_load:function(b,a){traceGroup('View Load "'+b+'"');this._active_view=a.getView();if(!this._stack.hasElm(this._active_view)){this._stack.addElm(this._active_view)}this._stack.setActive(this._active_view);this._active_view.addEventListener(NwNavView.LOAD,this,"_onViewLoadComplete");this._active_view.load.apply(this._active_view,[b,b.charAt(0)=="/"?b.substring(1).split("/"):b.split("/")]);this._active=a;this.dispatchEvent(new OjEvent(OjEvent.CHANGE))},_refreshStack:function(){if(this._stack){var b=this._stack.numElms(),a;for(;b--;){a=this._stack.getElmAt(b).getRoute();if(this._routing&&(this._routing==a||this._routing.hasChildRoute(a))){continue}this._stack.removeElmAt(b)}if(this._routing&&!this._active){this._onHashChange(null)}}},_onHashChange:function(a){if(this._routing){var e=this.getId();var c=HistoryManager.get();var d=c.getHashParam(e);var b=this._getDefaultRoute();if(d){b=this.getRouteByPath(d)}else{d=b.getPath()}if(!this._active||this._active!=b){if(b){if(!this._stack){return}this._load(d,b)}else{if(this._active){this.loadRoute(this._active)}}}}},_onRoutingLoad:function(a){this.loadRoute(a.getTarget(),a.getArguments())},_onRoutingChange:function(a){this._refreshStack()},_onViewLoadComplete:function(a){traceGroup();if(!this._active_view){return}this._active_view.removeEventListener(NwNavView.LOAD,this,"_onViewLoadComplete")},loadPath:function(b){var a=HistoryManager.get();a.setHashParam(this.getId(),b);OJ.open(a)},loadRoute:function(a){this.loadPath(a.pathWithArguments(arguments.length>1?arguments[1]:[]))},getRouteByPath:function(b){if(!this._routing){return null}var a=this._getRouteByPath(b,this._routing.getItems());if(a["1"]){return a["1"]}var d,c=99999;for(d in a){if(c>(d=parseInt(d))){c=d}}if(c==99999&&this._routing.pathIsMatch(b)){return this._routing}return a[c]},getActive:function(){return this._active},getActiveIndex:function(){return this._active_index},setRouting:function(a){if(this._routing==a){return}if(this._routing){this._routing.removeEventListener(NwNavRouteEvent.LOAD,this,"_onRoutingLoad")}if(this._routing=a){this._routing.addEventListener(NwNavRouteEvent.LOAD,this,"_onRoutingLoad");this._routing.addEventListener(NwNavRouteEvent.CHANGE,this,"_onRoutingChange")}this._refreshStack()},setStack:function(a){if(this._stack==a){return}if(this._stack){this._cleanupStack()}this._stack=a;this._setupStack()}}));