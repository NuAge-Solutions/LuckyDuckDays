OJ.importJs("nw.list.FilterBar");OJ.importJs("oj.list.List");"use strict";OJ.extendClass(OjList,"NwFilterList",{_props_:{filters:null,filterBar:null,keywords:null,sorting:"filterListSortRelevance"},_filter_list:null,_filtered_provider:null,_keyword_list:null,_scores:null,_constructor:function(){var a=this._super("NwFilterList","_constructor",arguments);this.setFilterBar(new NwFilterBar());return a},_setDom:function(a){this._super("NwFilterList","_setDom",arguments);this.container=new OjStyleElement();var b=this.numChildren();while(b-->0){this.container.addChildAt(this.getChildAt(b),0)}this.addChild(this.container)},_applyFiltersAndSorting:function(){var a=arguments.length;this._setKeywords(a>0?arguments[0]:this._keywords);this._setFilters(a>1?arguments[1]:this._filters);this._redrawItems()},_redrawItems:function(){var g,f,e,a,c,d;if(this._filter_list&&this._filter_list.numItems()){g=this._filter_list;f=this._keyword_list}else{if(this._keyword_list){g=this._keyword_list;f=this._filter_list}}if(g){if(f){this._filtered_provider=new OjCollection();e=g.numItems();a=f.numItems();while(e-->0){d=g.getItemAt(e);for(c=0;c<a;c++){if(f.getItemAt(c)==d){this._filtered_provider.addItem(d);break}}}}else{this._filtered_provider=g}}else{this._filtered_provider=this._data_provider}var b="_sortByRelevance";if(this._sorting==NwFilterList.SORT_NEWEST){b="_sortByNewest"}else{if(this._sorting==NwFilterList.SORT_OLDEST){b="_sortByOldest"}else{if(this._sorting==NwFilterList.SORT_AZ){b="_sortByAz"}else{if(this._sorting==NwFilterList.SORT_ZA){b="_sortByZa"}}}}this._filtered_provider.sort(this[b].bind(this));this._super("NwFilterList","_redrawItems",arguments)},_sortByAz:function(d,c){return d.title()>c.title()},_sortByNewest:function(d,c){return this._scores[c.id()]-this._scores[d.id()]},_sortByOldest:function(d,c){return this._scores[c.id()]-this._scores[d.id()]},_sortByRelevance:function(d,c){return this._scores[c.id()]-this._scores[d.id()]},_sortByZa:function(d,c){return d.title()<c.title()},addItem:function(b){var a=this._data_provider.addItem(b);this._applyFiltersAndSorting();return a},addItemAt:function(b,a){return this.addItem(b)},getItemAt:function(a){return this._filtered_provider.getItemAt(a)},getItemIndex:function(a){return this._filtered_provider.getItemIndex(a)},hasItem:function(a){return this._filtered_provider.hasItem(a)},numItems:function(){return this._filtered_provider.numItems()},removeItem:function(b){var a=this._data_provider.removeItem(b);this._applyFiltersAndSorting();return a},removeItemAt:function(a){return this.removeItem(this.getItemAt(a))},_onItemAdd:function(a){this._applyFiltersAndSorting();this.dispatchEvent(new OjListEvent(OjListEvent.ITEM_ADD,a.getItem(),a.getIndex()))},_onItemMove:function(a){this.dispatchEvent(new OjListEvent(OjListEvent.ITEM_MOVE,a.getItem(),a.getIndex()))},_onItemRemove:function(a){this._applyFiltersAndSorting();this.dispatchEvent(new OjListEvent(OjListEvent.ITEM_REMOVE,a.getItem(),a.getIndex()))},_onItemReplace:function(a){this._applyFiltersAndSorting();this.dispatchEvent(new OjListEvent(OjListEvent.ITEM_REPLACE,a.getItem(),a.getIndex()))},_setFilters:function(d){var f=!isEmpty(d);var e=arguments.length>1?arguments[1]:this._data_provider;var c,b,a;this._filter_list=new OjCollection();this._filters=d;if(e){c=e.numItems();while(c-->0){b=e.getItemAt(c);a=true;if(f){}if(a){this._filter_list.addItem(b)}}}},setFilters:function(a){if(this._filters==a){return}this._setFilters(a);this._redrawItems()},setFilterBar:function(a){if(this._filterBar){this._filterBar.setList(null);this.removeChild(this._filterBar)}this._filterBar=a;if(this._filterBar){this._filterBar.setList(this);this.addChildAt(this._filterBar,0)}},_setKeywords:function(a){var e=!isEmpty(a);var d=arguments.length>1?arguments[1]:this._data_provider;var c,b,f;this._keyword_list=new OjCollection();this._keywords=a;this._scores={};if(d){c=d.numItems();while(c-->0){b=d.getItemAt(c);f=1;if(e){f=b.keywordScore(a)}if(f){this._scores[b.id()]=f;this._keyword_list.addItem(b)}}}},setKeywords:function(a){if(this._keywords==a){return}this._setKeywords(a);this._redrawItems()},setSorting:function(a){if(this._sorting==a){return}this._sorting=a;this._redrawItems()},setDataProvider:function(a){this._filtered_provider=new OjCollection(a);this._setKeywords(this._keywords,this._filtered_provider);this._setFilters(this._filters,this._filtered_provider);return this._super("NwFilterList","setDataProvider",arguments)}},{SORT_AZ:"filterListSortAZ",SORT_NEWEST:"filterListSortNewest",SORT_OLDEST:"filterListSortOldest",SORT_RELEVANCE:"filterListSortRelevance",SORT_ZA:"filterListSortZA"});